<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Library.Views.StatisticsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:services="clr-namespace:Library.Services"
             xmlns:system="clr-namespace:System;assembly=netstandard"
             Title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ScrollView>
        <StackLayout Padding="20" Spacing="20">
            
            <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º -->
            <Frame BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   CornerRadius="15" 
                   Padding="20" 
                   HasShadow="True">
                <StackLayout Spacing="15">
                    <Label Text="üìÖ –ü–µ—Ä–∏–æ–¥" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    
                    <Picker x:Name="DateFilterPicker"
                            Title="–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥"
                            SelectedIndexChanged="OnDateFilterChanged"
                            TextColor="{DynamicResource PrimaryTextColor}"
                            TitleColor="{DynamicResource SecondaryTextColor}">
                        <Picker.Items>
                            <x:String>–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 60 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 180 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 365 –¥–Ω–µ–π</x:String>
                            <x:String>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ</x:String>
                        </Picker.Items>
                    </Picker>
                    
                    <!-- –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ -->
                    <StackLayout x:Name="CustomDateRangeLayout" 
                                 IsVisible="False"
                                 Spacing="10">
                        <Label Text="–û—Ç:" 
                               FontSize="14" 
                               TextColor="{DynamicResource PrimaryTextColor}" />
                        <DatePicker x:Name="StartDatePicker"
                                    Date="{x:Static system:DateTime.Now}"
                                    DateSelected="OnCustomDateChanged"
                                    TextColor="{DynamicResource PrimaryTextColor}" />
                        
                        <Label Text="–î–æ:" 
                               FontSize="14" 
                               TextColor="{DynamicResource PrimaryTextColor}" />
                        <DatePicker x:Name="EndDatePicker"
                                    Date="{x:Static system:DateTime.Now}"
                                    DateSelected="OnCustomDateChanged"
                                    TextColor="{DynamicResource PrimaryTextColor}" />
                    </StackLayout>
                </StackLayout>
            </Frame>
            
            <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <Frame BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   CornerRadius="15" 
                   Padding="20" 
                   HasShadow="True">
                <StackLayout>
                    <Label Text="üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" 
                           FontSize="20" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />

                    <Grid ColumnDefinitions="*,*" RowDefinitions="*,*,*" 
                          ColumnSpacing="15" RowSpacing="15" Margin="0,20,0,0">

                        <Frame Grid.Row="0" Grid.Column="0" 
                               BackgroundColor="{DynamicResource PrimaryColor}" 
                               CornerRadius="10" 
                               Padding="15">
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="TotalBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                                <Label Text="–í—Å–µ–≥–æ –∫–Ω–∏–≥" 
                                       FontSize="12" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="0" Grid.Column="1" 
                               BackgroundColor="{DynamicResource SecondaryColor}" 
                               CornerRadius="10" 
                               Padding="15">
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="ReadBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                                <Label Text="–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" 
                                       FontSize="12" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="1" Grid.Column="0" 
                               BackgroundColor="Green" 
                               CornerRadius="10" 
                               Padding="15">
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="CurrentBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                                <Label Text="–ß–∏—Ç–∞—é —Å–µ–π—á–∞—Å" 
                                       FontSize="12" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="1" Grid.Column="1" 
                               BackgroundColor="Orange" 
                               CornerRadius="10" 
                               Padding="15">
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="PlannedBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                                <Label Text="–í –ø–ª–∞–Ω–∞—Ö" 
                                       FontSize="12" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="2" Grid.ColumnSpan="2" 
                               BackgroundColor="Purple" 
                               CornerRadius="10" 
                               Padding="15">
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="TotalPagesLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                                <Label Text="–í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–æ—á–∏—Ç–∞–Ω–æ" 
                                       FontSize="12" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                    </Grid>
                </StackLayout>
            </Frame>

            <!-- –¢–æ–ø –∞–≤—Ç–æ—Ä–æ–≤ -->
            <Frame BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   CornerRadius="15" 
                   Padding="20" 
                   HasShadow="True">
                <StackLayout>
                    <Label Text="üë®‚Äçüíº –õ—é–±–∏–º—ã–µ –∞–≤—Ç–æ—Ä—ã" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    
                    <CollectionView x:Name="AuthorsCollectionView" 
                                     Margin="0,15,0,0">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="services:AuthorStatistic">
                                <Grid ColumnDefinitions="*,Auto" Padding="10">
                                    <Label Grid.Column="0" 
                                           Text="{Binding Author}" 
                                           FontSize="14" 
                                           TextColor="{DynamicResource PrimaryTextColor}" />
                                    <Label Grid.Column="1" 
                                           Text="{Binding Count, StringFormat='{0} –∫–Ω–∏–≥'}" 
                                           FontSize="14" 
                                           TextColor="{DynamicResource SecondaryTextColor}" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

        </StackLayout>
    </ScrollView>

</ContentPage>
