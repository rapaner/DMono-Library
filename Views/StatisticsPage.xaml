<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Library.Views.StatisticsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Library.Models"
             xmlns:services="clr-namespace:Library.Services"
             xmlns:system="clr-namespace:System;assembly=netstandard"
             Title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ScrollView>
        <StackLayout Padding="20" Spacing="20">
            
            <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º -->
            <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   Padding="20" 
                   StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <StackLayout Spacing="15">
                    <Label Text="üìÖ –ü–µ—Ä–∏–æ–¥" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    
                    <Picker x:Name="DateFilterPicker"
                            Title="–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥"
                            SelectedIndexChanged="OnDateFilterChanged"
                            TextColor="{DynamicResource PrimaryTextColor}"
                            TitleColor="{DynamicResource SecondaryTextColor}">
                        <Picker.Items>
                            <x:String>–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 60 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 180 –¥–Ω–µ–π</x:String>
                            <x:String>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 365 –¥–Ω–µ–π</x:String>
                            <x:String>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ</x:String>
                        </Picker.Items>
                    </Picker>
                    
                    <!-- –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ -->
                    <StackLayout x:Name="CustomDateRangeLayout" 
                                 IsVisible="False"
                                 Spacing="10">
                        <Label Text="–û—Ç:" 
                               FontSize="14" 
                               TextColor="{DynamicResource PrimaryTextColor}" />
                        <DatePicker x:Name="StartDatePicker"
                                    Date="{x:Static system:DateTime.Now}"
                                    DateSelected="OnCustomDateChanged"
                                    TextColor="{DynamicResource PrimaryTextColor}" />
                        
                        <Label Text="–î–æ:" 
                               FontSize="14" 
                               TextColor="{DynamicResource PrimaryTextColor}" />
                        <DatePicker x:Name="EndDatePicker"
                                    Date="{x:Static system:DateTime.Now}"
                                    DateSelected="OnCustomDateChanged"
                                    TextColor="{DynamicResource PrimaryTextColor}" />
                    </StackLayout>
                </StackLayout>
            </Border>
            
            <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   Padding="20" 
                   StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <StackLayout>
                    <Label Text="üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" 
                           FontSize="20" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />

                    <Grid ColumnDefinitions="*,*" RowDefinitions="*,*,*" 
                          ColumnSpacing="15" RowSpacing="15" Margin="0,20,0,0">

                        <Border Grid.Row="0" Grid.Column="0" 
                               BackgroundColor="{DynamicResource PrimaryColor}" 
                               Padding="15"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="TotalBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="{DynamicResource SecondaryTextColor}" 
                                       HorizontalOptions="Center" />
                                <Label Text="–í—Å–µ–≥–æ –∫–Ω–∏–≥" 
                                       FontSize="12" 
                                       TextColor="{DynamicResource SecondaryTextColor}" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Border>

                        <Border Grid.Row="0" Grid.Column="1" 
                               BackgroundColor="{DynamicResource SecondaryColor}" 
                               Padding="15"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="ReadBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                                <Label Text="–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" 
                                       FontSize="12" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Border>

                        <Border Grid.Row="1" Grid.Column="0" 
                               BackgroundColor="{DynamicResource TertiaryColor}" 
                               Padding="15"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="CurrentBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                                <Label Text="–ß–∏—Ç–∞—é —Å–µ–π—á–∞—Å" 
                                       FontSize="12" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Border>

                        <Border Grid.Row="1" Grid.Column="1" 
                               BackgroundColor="{DynamicResource AccentColor}" 
                               Padding="15"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="PlannedBooksLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                                <Label Text="–í –ø–ª–∞–Ω–∞—Ö" 
                                       FontSize="12" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Border>

                        <Border Grid.Row="2" Grid.ColumnSpan="2" 
                               BackgroundColor="{DynamicResource SuccessColor}" 
                               Padding="15"
                               StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <StackLayout HorizontalOptions="Center">
                                <Label x:Name="TotalPagesLabel" 
                                       Text="0" 
                                       FontSize="24" 
                                       FontAttributes="Bold" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                                <Label Text="–í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–æ—á–∏—Ç–∞–Ω–æ" 
                                       FontSize="12" 
                                       TextColor="{DynamicResource PrimaryTextColor}" 
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </Border>

                    </Grid>
                </StackLayout>
            </Border>

            <!-- –ì—Ä–∞—Ñ–∏–∫ —á—Ç–µ–Ω–∏—è –ø–æ –¥–Ω—è–º -->
            <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   Padding="20" 
                   StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <StackLayout>
                    <Label Text="üìà –ì—Ä–∞—Ñ–∏–∫ —á—Ç–µ–Ω–∏—è" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    
                    <Label x:Name="ChartDescriptionLabel"
                           Text="–°—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –ø–æ –¥–Ω—è–º"
                           FontSize="12"
                           TextColor="{DynamicResource SecondaryTextColor}"
                           Margin="0,5,0,5" />
                    
                    <Label x:Name="AverageDailyLabel"
                           Text="–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –¥–µ–Ω—å - 0.00"
                           FontSize="12"
                           TextColor="{DynamicResource SecondaryTextColor}"
                           Margin="0,0,0,10" />
                    
                    <ScrollView Orientation="Horizontal" 
                                HorizontalScrollBarVisibility="Always"
                                Margin="0,10,0,0">
                        <GraphicsView x:Name="ReadingChartView"
                                      HeightRequest="250"
                                      WidthRequest="400"
                                      BackgroundColor="Transparent" />
                    </ScrollView>
                </StackLayout>
            </Border>

            <!-- –†–µ–π—Ç–∏–Ω–≥ –∫–Ω–∏–≥ -->
            <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   Padding="20" 
                   StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <StackLayout>
                    <Label Text="üìö –†–µ–π—Ç–∏–Ω–≥ –∫–Ω–∏–≥" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    
                    <Label Text="–ü–æ —Å—Ä–µ–¥–Ω–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –¥–µ–Ω—å"
                           FontSize="12"
                           TextColor="{DynamicResource SecondaryTextColor}"
                           Margin="0,5,0,10" />
                    
                    <CollectionView x:Name="BookRankingsCollectionView" 
                                     Margin="0,5,0,0">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:BookRanking">
                                <Border BackgroundColor="{DynamicResource PageBackgroundColor}"
                                        Padding="15"
                                        Margin="0,5"
                                        StrokeThickness="0">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10"/>
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto">
                                        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ -->
                                        <Label Grid.Column="0" Grid.Row="0"
                                               Text="{Binding Title}" 
                                               FontSize="16" 
                                               FontAttributes="Bold"
                                               TextColor="{DynamicResource PrimaryTextColor}"
                                               LineBreakMode="WordWrap"
                                               MaxLines="2"
                                               VerticalOptions="Start" />
                                        
                                        <!-- –ê–≤—Ç–æ—Ä—ã -->
                                        <Label Grid.Column="0" Grid.Row="1"
                                               Text="{Binding AuthorsText}" 
                                               FontSize="13" 
                                               TextColor="{DynamicResource SecondaryTextColor}"
                                               LineBreakMode="WordWrap"
                                               MaxLines="2"
                                               VerticalOptions="Start"
                                               Margin="0,5,0,0" />
                                        
                                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á—Ç–µ–Ω–∏—è -->
                                        <StackLayout Grid.Column="1" Grid.Row="0" Grid.RowSpan="2"
                                                     VerticalOptions="Center"
                                                     HorizontalOptions="End"
                                                     Spacing="2">
                                            <Label Text="{Binding AveragePagesPerDay, StringFormat='{0:F2}'}" 
                                                   FontSize="20" 
                                                   FontAttributes="Bold"
                                                   TextColor="{DynamicResource PrimaryColor}"
                                                   HorizontalOptions="End" />
                                            <Label Text="—Å—Ç—Ä/–¥–µ–Ω—å" 
                                                   FontSize="12" 
                                                   TextColor="{DynamicResource SecondaryTextColor}"
                                                   HorizontalOptions="End" />
                                        </StackLayout>
                                        
                                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                                        <Label Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2"
                                               Text="{Binding TotalPagesRead, StringFormat='–í—Å–µ–≥–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ: {0} —Å—Ç—Ä–∞–Ω–∏—Ü'}" 
                                               FontSize="11" 
                                               TextColor="{DynamicResource SecondaryTextColor}"
                                               VerticalOptions="Start"
                                               Margin="0,8,0,0" />
                                        <Label Grid.Column="0" Grid.Row="3" Grid.ColumnSpan="2"
                                               Text="{Binding UniqueDaysCount, StringFormat='–ß–∏—Ç–∞–ª–æ—Å—å: {0} –¥–Ω–µ–π'}" 
                                               FontSize="11" 
                                               TextColor="{DynamicResource SecondaryTextColor}"
                                               VerticalOptions="Start"
                                               Margin="0,2,0,0" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Border>

            <!-- –¢–æ–ø –∞–≤—Ç–æ—Ä–æ–≤ -->
            <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                   Padding="20" 
                   StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <StackLayout>
                    <Label Text="üë®‚Äçüíº –õ—é–±–∏–º—ã–µ –∞–≤—Ç–æ—Ä—ã" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    
                    <CollectionView x:Name="AuthorsCollectionView" 
                                     Margin="0,15,0,0">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:AuthorStatistic">
                                <Grid ColumnDefinitions="*,Auto" Padding="10">
                                    <Label Grid.Column="0" 
                                           Text="{Binding Author}" 
                                           FontSize="14" 
                                           TextColor="{DynamicResource PrimaryTextColor}" />
                                    <Label Grid.Column="1" 
                                           Text="{Binding Count, StringFormat='{0} –∫–Ω–∏–≥'}" 
                                           FontSize="14" 
                                           TextColor="{DynamicResource SecondaryTextColor}" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Border>

        </StackLayout>
    </ScrollView>

</ContentPage>
